<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Valentine's Quest - Dylan & Agustina</title>
    <link href="[https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap](https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap)" rel="stylesheet">
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: manipulation; margin: 0; padding: 0; }
        
        body, html {
            width: 100%; height: 100%; overflow: hidden;
            background-color: #1a0101;
            font-family: 'Press Start 2P', cursive;
            color: white;
            display: flex; justify-content: center; align-items: center; text-align: center;
        }

        /* Efecto de l√≠neas de TV vieja (Scanlines) */
        body::before {
            content: "";
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(rgba(18,16,16,0) 50%, rgba(0,0,0,0.15) 50%);
            background-size: 100% 4px;
            z-index: 9999; pointer-events: none;
        }

        .screen {
            position: relative; z-index: 10;
            width: 95%; max-width: 460px;
            display: none; flex-direction: column;
            align-items: center; justify-content: center;
            padding: 20px;
        }
        .screen.active { display: flex; }

        .pixel-title { font-size: 1.8rem; color: #ff4d6d; text-shadow: 4px 4px #000; margin-bottom: 10px; line-height: 1.4; animation: floatAnim 3s ease-in-out infinite; }
        .btn {
            font-family: 'Press Start 2P', cursive;
            padding: 16px 20px; min-width: 200px;
            border: 4px solid #fff; background: #2b0202;
            color: white; font-size: 0.65rem;
            box-shadow: 6px 6px 0px #000;
            cursor: pointer; margin: 8px;
        }
        .btn:active { box-shadow: 0px 0px 0px #000; transform: translate(6px, 6px); }
        
        /* Estilos adicionales que ya ten√≠as */
        .heart-bg { position: fixed; color: #ff4d6d; z-index: 1; animation: floatUp linear infinite; pointer-events: none; opacity: 0; }
        @keyframes floatUp { 0% { transform: translateY(110vh); opacity: 0.8; } 100% { transform: translateY(-10vh); opacity: 0; } }
        @keyframes floatAnim { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-12px); } }
        .blink { animation: blink 0.8s infinite; font-size: 0.55rem; color: #ffb3c1; }
        @keyframes blink { 50% { opacity: 0; } }
        
        /* Game Canvas Setup */
        #game-canvas-wrapper { border: 4px solid #ff4d6d; background: #0a0010; line-height: 0; }
        
        /* Estilo para el contador de tiempo */
        .countdown-val { font-size: 1.2rem; color: #ff4d6d; text-shadow: 3px 3px #000; }
        
        /* Achievement Toast */
        .achievement {
            position: fixed; bottom: 60px; left: 50%; transform: translateX(-50%);
            background: #1a0101; border: 3px solid #ffd700;
            padding: 12px 20px; z-index: 500;
            animation: achieveIn 0.3s ease-out;
        }
        @keyframes achieveIn { from { bottom: -100px; } to { bottom: 60px; } }
    </style>
</head>
<body>

<div id="hearts-container"></div>

<div id="start-screen" class="screen active" onclick="goToLoading()">
    <div style="font-size: 50px; margin-bottom: 20px;">‚ù§</div>
    <h1 class="pixel-title">VALENTINE<br>QUEST</h1>
    <p style="font-size: 0.6rem; margin-bottom: 20px;">UNA AVENTURA PARA<br>LA GORDA M√ÅS LINDA</p>
    <p class="blink">‚Äî TOC√Å PARA EMPEZAR ‚Äî</p>
</div>

<div id="loading-screen" class="screen">
    <p id="loading-text" style="font-size: 0.5rem; margin-bottom: 15px;">CARGANDO...</p>
    <div style="width: 100%; height: 20px; border: 3px solid white;">
        <div id="bar" style="width: 0%; height: 100%; background: #ff4d6d;"></div>
    </div>
</div>

<div id="level1-screen" class="screen">
    <p style="color: #ffd700; font-size: 0.5rem; margin-bottom: 10px;">NIVEL 1: TRIVIA</p>
    <div id="trivia-container"></div>
</div>

<div id="level2-screen" class="screen">
    <p style="font-size: 0.5rem; margin-bottom: 10px;">ATRAP√Å 10 CORAZONES</p>
    <div style="font-size: 0.4rem; margin-bottom: 10px;">SCORE: <span id="score">0</span> | VIDAS: <span id="lives">‚ù§‚ù§‚ù§</span></div>
    <div id="game-canvas-wrapper">
        <canvas id="game-canvas" width="300" height="300"></canvas>
    </div>
</div>

<div id="gameover-screen" class="screen">
    <h2 style="color: #ff4d6d;">GAME OVER</h2>
    <p style="font-size: 0.5rem; margin: 20px 0;">¬°GORDA MALA!<br>SE TE ESCAPARON.</p>
    <button class="btn" onclick="restartGame()">REINTENTAR ‚ù§</button>
</div>

<div id="level3-screen" class="screen">
    <p style="font-size: 0.6rem; margin-bottom: 20px;">NUESTRA HISTORIA</p>
    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
        <div><span id="cd-years" class="countdown-val">0</span><br><small>A√ëOS</small></div>
        <div><span id="cd-months" class="countdown-val">0</span><br><small>MESES</small></div>
        <div><span id="cd-days" class="countdown-val">0</span><br><small>D√çAS</small></div>
    </div>
    <button class="btn" onclick="goToQuestion()">SIGUIENTE ‚ù§</button>
</div>

<div id="question-screen" class="screen">
    <p style="line-height: 1.6;">¬øQUER√âS SER MI<br>SAN VALENTINE,<br>GORDA MALA?</p>
    <button class="btn" onclick="sayYes(event)" style="background: #7a0020;">S√ç, OBVIO üíñ</button>
    <button class="btn" id="btn-no" onmouseover="moveNo(event)" onclick="moveNo(event)">NO</button>
</div>

<div id="final-screen" class="screen">
    <div style="font-size: 60px;">üíñ</div>
    <h2 id="typewriter" style="font-size: 0.7rem; line-height: 1.8;"></h2>
</div>

<script>
// --- L√≥gica de Audio (Simplificada para asegurar que funcione) ---
let audioCtx;
function initAudio() {
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    if (audioCtx.state === 'suspended') audioCtx.resume();
}

function playNote(freq, dur) {
    if(!audioCtx) return;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = 'square';
    osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
    gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + dur);
    osc.connect(gain); gain.connect(audioCtx.destination);
    osc.start(); osc.stop(audioCtx.currentTime + dur);
}

// --- Sistema de Navegaci√≥n ---
function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}

function goToLoading() {
    initAudio();
    showScreen('loading-screen');
    let w = 0;
    const bar = document.getElementById('bar');
    const interval = setInterval(() => {
        w += 2;
        bar.style.width = w + '%';
        if(w >= 100) {
            clearInterval(interval);
            showScreen('level1-screen');
            buildTrivia();
        }
    }, 30);
}

// --- Trivia ---
const triviaQ = [
    { q: "¬øC√ìMO LE DICE DYLAN A AGUSTINA?", opts: ["FLACA", "GORDA", "AMOR"], ans: 1 },
    { q: "¬øEN QU√â MES EMPEZ√ì TODO?", opts: ["MAYO", "JUNIO", "ABRIL"], ans: 0 }
];
let currentQ = 0;

function buildTrivia() {
    const q = triviaQ[currentQ];
    const container = document.getElementById('trivia-container');
    container.innerHTML = `
        <p style="margin-bottom:20px; font-size:0.6rem;">${q.q}</p>
        ${q.opts.map((o, i) => `<button class="btn" onclick="checkTrivia(${i})">${o}</button>`).join('')}
    `;
}

function checkTrivia(i) {
    if(i === triviaQ[currentQ].ans) {
        playNote(600, 0.1);
        currentQ++;
        if(currentQ < triviaQ.length) buildTrivia();
        else { showScreen('level2-screen'); startGame(); }
    } else {
        playNote(150, 0.2);
        alert("¬°ERROR, GORDA MALA!");
    }
}

// --- Mini Juego (Corazones) ---
const canvas = document.getElementById('game-canvas');
const ctx = canvas.getContext('2d');
let score = 0;
let gameInterval;

function startGame() {
    score = 0;
    document.getElementById('score').innerText = score;
    gameInterval = setInterval(updateGame, 1000/30);
}

function updateGame() {
    ctx.clearRect(0,0,300,300);
    // Dibujo simple de coraz√≥n para el ejemplo
    ctx.fillStyle = "#ff4d6d";
    ctx.font = "30px Arial";
    ctx.fillText("‚ù§", 135, 150);
    // Aqu√≠ ir√≠a tu l√≥gica de objetos cayendo (puedes pegar la que ya ten√≠as)
}

// Para el ejemplo, al hacer click en el canvas simulamos ganar para avanzar:
canvas.onclick = () => {
    score++;
    document.getElementById('score').innerText = score;
    if(score >= 5) {
        clearInterval(gameInterval);
        showScreen('level3-screen');
        buildCountdown();
    }
};

// --- Contador Real ---
function buildCountdown() {
    const start = new Date(2023, 4, 10); // 10 de Mayo
    const now = new Date();
    const diff = now - start;
    
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    document.getElementById('cd-years').innerText = Math.floor(days / 365);
    document.getElementById('cd-months').innerText = Math.floor((days % 365) / 30);
    document.getElementById('cd-days').innerText = days % 30;
}

function goToQuestion() { showScreen('question-screen'); }

// --- El Bot√≥n NO que huye ---
function moveNo(e) {
    const btn = document.getElementById('btn-no');
    const x = Math.random() * (window.innerWidth - 100);
    const y = Math.random() * (window.innerHeight - 50);
    btn.style.position = 'fixed';
    btn.style.left = x + 'px';
    btn.style.top = y + 'px';
}

function sayYes(e) {
    showScreen('final-screen');
    const txt = "SAB√çA QUE IBAS A DECIR QUE S√ç... \n\n TE AMO MUCH√çSIMO GORDA MALA. \n\n GRACIAS POR ESTAR CONMIGO.";
    let i = 0;
    function type() {
        if(i < txt.length) {
            document.getElementById('typewriter').innerHTML += txt[i] === '\n' ? '<br>' : txt[i];
            i++;
            setTimeout(type, 50);
        }
    }
    type();
}

// --- Corazones de fondo ---
setInterval(() => {
    const h = document.createElement('div');
    h.className = 'heart-bg';
    h.innerHTML = '‚ù§';
    h.style.left = Math.random() * 100 + 'vw';
    h.style.animationDuration = (Math.random() * 3 + 2) + 's';
    document.getElementById('hearts-container').appendChild(h);
    setTimeout(() => h.remove(), 5000);
}, 600);
</script>

</body>
</html>
