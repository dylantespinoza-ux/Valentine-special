<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Valentine's Quest - Dylan & Agustina</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: manipulation; margin: 0; padding: 0; }

        body, html {
            width: 100%; height: 100%; overflow: hidden;
            background-color: #1a0101;
            font-family: 'Press Start 2P', cursive;
            color: white;
            display: flex; justify-content: center; align-items: center; text-align: center;
            /* Fade in para evitar salto de fuente */
            opacity: 0; animation: fadeInBody 0.8s forwards 0.2s;
        }

        @keyframes fadeInBody { to { opacity: 1; } }

        body::before {
            content: "";
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(rgba(18,16,16,0) 50%, rgba(0,0,0,0.15) 50%);
            background-size: 100% 4px;
            z-index: 9999; pointer-events: none;
        }
        body::after {
            content: "";
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(ellipse at center, transparent 60%, rgba(0,0,0,0.7) 100%);
            z-index: 9998; pointer-events: none;
        }

        .heart-bg {
            position: fixed; color: #ff4d6d; font-size: 18px; z-index: 1;
            animation: floatUp linear infinite; pointer-events: none; opacity: 0;
        }
        @keyframes floatUp {
            0%   { transform: translateY(110vh) rotate(0deg) scale(1); opacity: 0.8; }
            100% { transform: translateY(-10vh) rotate(360deg) scale(0.5); opacity: 0; }
        }

        .screen {
            position: relative; z-index: 10;
            width: 95%; max-width: 460px;
            display: none; flex-direction: column;
            align-items: center; justify-content: center;
            padding: 20px;
        }
        .screen.active { display: flex; }

        #start-screen { cursor: pointer; }

        .pixel-title { font-size: 2rem; color: #ff4d6d; text-shadow: 4px 4px #000; margin-bottom: 10px; line-height: 1.6; animation: floatAnim 3s ease-in-out infinite; }
        .pixel-subtitle { font-size: 0.65rem; color: #ffb3c1; text-shadow: 2px 2px #000; margin-bottom: 25px; line-height: 1.8; }
        .heart-icon { font-size: 60px; margin-bottom: 15px; animation: beat 0.8s infinite alternate; display: inline-block; text-shadow: 4px 4px #000; }
        @keyframes beat { from { transform: scale(1); } to { transform: scale(1.2); } }
        @keyframes floatAnim { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-12px); } }

        .blink { animation: blink 0.8s infinite; font-size: 0.55rem; color: #ffb3c1; margin-top: 20px; }
        @keyframes blink { 50% { opacity: 0; } }

        .loading-text { font-size: 0.5rem; margin-bottom: 15px; color: #ffb3c1; line-height: 2; }
        .progress-container { width: 100%; height: 30px; border: 4px solid white; padding: 3px; background: #000; box-shadow: 0 0 20px rgba(255,77,109,0.4); }
        .progress-bar { width: 0%; height: 100%; background: linear-gradient(90deg, #ff4d6d, #ff85a1); transition: width 0.04s linear; }

        .btn {
            font-family: 'Press Start 2P', cursive;
            padding: 16px 20px; min-width: 200px;
            border: 4px solid #fff; background: #2b0202;
            color: white; font-size: 0.65rem;
            box-shadow: 6px 6px 0px #000;
            cursor: pointer; margin: 8px;
            transition: none;
            user-select: none; /* Evita selecciÃ³n de texto al tocar rÃ¡pido */
        }
        .btn:active { box-shadow: 0px 0px 0px #000; transform: translate(6px, 6px); }
        .btn.yes { background: #7a0020; border-color: #ff4d6d; color: #ffb3c1; }
        .btn.yes:hover { background: #a3002a; }

        .level-title { font-size: 0.75rem; color: #ff4d6d; margin-bottom: 6px; text-shadow: 3px 3px #000; }
        .level-desc  { font-size: 0.45rem; color: #ffb3c1; line-height: 2; margin-bottom: 20px; }
        .level-badge { font-size: 0.4rem; color: #ffd700; margin-bottom: 15px; letter-spacing: 1px; }

        /* CORRECCIÃ“N RESPONSIVE DEL CANVAS */
        #game-canvas-wrapper {
            position: relative; 
            width: 300px; height: 300px;
            max-width: 90vw; max-height: 90vw; /* Adaptable a pantallas chicas */
            border: 4px solid #ff4d6d; background: #0a0010;
            overflow: hidden; box-shadow: 0 0 20px rgba(255,77,109,0.5);
            margin: 0 auto;
        }
        #game-canvas { width: 100%; height: 100%; display: block; }
        
        .game-ui { font-size: 0.45rem; color: #ffb3c1; margin-bottom: 8px; display: flex; justify-content: space-between; width: 100%; max-width: 300px; flex-wrap: wrap; gap: 4px; }
        .game-instructions { font-size: 0.4rem; color: #888; margin-top: 8px; line-height: 2; }

        .combo-popup {
            position: fixed; pointer-events: none; z-index: 200;
            font-family: 'Press Start 2P', cursive;
            font-size: 0.7rem; color: #ffd700; text-shadow: 2px 2px #000;
            animation: comboAnim 0.8s ease-out forwards;
        }
        @keyframes comboAnim {
            0%   { opacity: 1; transform: translateY(0) scale(1.2); }
            100% { opacity: 0; transform: translateY(-50px) scale(0.8); }
        }

        #gameover-screen .go-title { font-size: 1.2rem; color: #ff4d6d; text-shadow: 4px 4px #000; margin-bottom: 20px; animation: floatAnim 1s ease-in-out infinite; }
        #gameover-screen .go-sub   { font-size: 0.5rem; color: #ffb3c1; line-height: 2.5; margin-bottom: 25px; }

        .countdown-box { background: #0a0010; border: 4px solid #ff4d6d; padding: 20px 30px; margin-bottom: 20px; box-shadow: 0 0 20px rgba(255,77,109,0.4); }
        .countdown-title { font-size: 0.5rem; color: #ffb3c1; margin-bottom: 15px; line-height: 2; }
        .countdown-numbers { display: flex; gap: 15px; justify-content: center; align-items: center; }
        .countdown-unit { display: flex; flex-direction: column; align-items: center; gap: 8px; }
        .countdown-val { font-size: 1.2rem; color: #ff4d6d; text-shadow: 3px 3px #000; min-width: 2ch; }
        .countdown-label { font-size: 0.3rem; color: #888; }
        .countdown-sep { font-size: 1.2rem; color: #ff4d6d; margin-bottom: 15px; }

        .question-text { font-size: 0.75rem; color: #ffb3c1; line-height: 2; margin-bottom: 25px; text-shadow: 2px 2px #000; }
        #btn-no { position: relative; z-index: 100; transition: transform 0.1s; }

        #final-screen h2 { font-size: 0.7rem; line-height: 2.5; color: #ffb3c1; text-shadow: 2px 2px #000; }
        .fireworks-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 5; }

        #valentines-special .vday-title { font-size: 0.9rem; color: #ffd700; text-shadow: 3px 3px #000; line-height: 2; margin-bottom: 15px; animation: floatAnim 2s ease-in-out infinite; }
        #valentines-special .vday-sub   { font-size: 0.5rem; color: #ffb3c1; line-height: 2.5; margin-bottom: 20px; }
        .vday-badge { background: #ffd700; color: #000; padding: 8px 16px; font-size: 0.4rem; margin-bottom: 20px; box-shadow: 4px 4px #000; animation: beat 0.6s infinite alternate; display: inline-block; }

        .achievement {
            position: fixed; bottom: 60px; left: 50%; transform: translateX(-50%);
            background: #1a0101; border: 3px solid #ffd700;
            padding: 12px 20px; z-index: 500;
            box-shadow: 4px 4px #000, 0 0 20px rgba(255,215,0,0.4);
            animation: achieveIn 0.3s ease-out, achieveOut 0.4s ease-in 2.5s forwards;
            white-space: nowrap;
        }
        .achievement .ach-label { font-size: 0.3rem; color: #ffd700; margin-bottom: 6px; }
        .achievement .ach-title { font-size: 0.45rem; color: #fff; }
        @keyframes achieveIn  { from { opacity:0; transform: translateX(-50%) translateY(20px); } to { opacity:1; transform: translateX(-50%) translateY(0); } }
        @keyframes achieveOut { from { opacity:1; } to { opacity:0; transform: translateX(-50%) translateY(20px); } }

        .stats { position: fixed; bottom: 10px; left: 0; width: 100%; font-size: 0.38rem; color: #ff4d6d; opacity: 0.6; letter-spacing: 1px; z-index: 100; text-align: center; }

        @keyframes shake {
            0%   { transform: translate(1px,1px); }
            20%  { transform: translate(-3px,0px); }
            40%  { transform: translate(3px,2px); }
            60%  { transform: translate(1px,-1px); }
            80%  { transform: translate(-1px,2px); }
            100% { transform: translate(0,0); }
        }
        .shake { animation: shake 0.3s; }

        .confetti-piece { position: fixed; pointer-events: none; z-index: 50; width: 8px; height: 8px; animation: confettiFall linear forwards; }
        @keyframes confettiFall {
            0%   { transform: translateY(-10px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
        }

        @keyframes flashRed {
            0%,100% { background-color: #1a0101; }
            50%      { background-color: #4a0000; }
        }
        .flash-red { animation: flashRed 0.2s 2; }

        #stars-canvas {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 0; pointer-events: none;
        }
        #cats-canvas {
            position: fixed; bottom: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 2; pointer-events: none;
        }
    </style>
</head>
<body>

<canvas id="stars-canvas"></canvas>
<canvas id="cats-canvas"></canvas>

<div id="hearts-container"></div>
<div class="fireworks-container" id="fireworks"></div>

<div id="start-screen" class="screen active" onclick="goToLoading()">
    <div class="heart-icon">â¤</div>
    <h1 class="pixel-title">VALENTINE<br>QUEST</h1>
    <p class="pixel-subtitle">UNA AVENTURA PARA<br>LA GORDA MÃS LINDA</p>
    <p class="blink">â€” TOCÃ PARA EMPEZAR â€”</p>
</div>

<div id="valentines-special" class="screen">
    <div class="vday-badge">ğŸŒŸ 14 DE FEBRERO ğŸŒŸ</div>
    <div class="heart-icon">ğŸ’</div>
    <p class="vday-title">Â¡FELIZ DÃA DE<br>SAN VALENTÃN!</p>
    <p class="vday-sub">HOY ES UN DÃA<br>MUY ESPECIAL,<br>GORDA â¤</p>
    <button class="btn yes" onclick="goToLoading()">EMPEZAR â¤</button>
</div>

<div id="loading-screen" class="screen">
    <p class="loading-text" id="loading-text">CARGANDO ALGO RE LINDO<br>PARA MI GORDA MALA...</p>
    <div class="progress-container"><div class="progress-bar" id="bar"></div></div>
    <p class="blink" style="margin-top:15px; font-size:0.4rem;">â—† â—† â—†</p>
</div>

<div id="level1-screen" class="screen">
    <p class="level-badge">â­ NIVEL 1 DE 3 â­</p>
    <p class="level-title">MISIÃ“N: TRIVIA</p>
    <p class="level-desc">DEMOSTRÃ QUE SABÃ‰S<br>ALGO DE DYLAN</p>
    <div id="trivia-container"></div>
</div>

<div id="level2-screen" class="screen">
    <p class="level-badge">â­ NIVEL 2 DE 3 â­</p>
    <p class="level-title">MISIÃ“N: ATRAPAR â¤</p>
    <p class="level-desc" style="margin-bottom:8px;">ATRAPÃ 10 CORAZONES<br>Â¡EVITÃ LAS BOMBAS ğŸ’£!</p>
    <div class="game-ui">
        <span>SCORE: <span id="score">0</span>/10</span>
        <span>COMBO: <span id="combo-display">x1</span></span>
        <span>VIDAS: <span id="lives">â¤â¤â¤</span></span>
    </div>
    <div id="game-canvas-wrapper">
        <canvas id="game-canvas" width="300" height="300"></canvas>
    </div>
    <p class="game-instructions">TOCÃ LOS â¤ Â· ESQUIVÃ LAS ğŸ’£</p>
</div>

<div id="gameover-screen" class="screen">
    <p class="go-title">GAME OVER</p>
    <p class="go-sub">SE TE ESCAPARON<br>TODOS LOS CORAZONES...<br>IGUAL TE AMO, GORDA ğŸ’€â¤</p>
    <button class="btn yes" onclick="restartGame()">REINTENTAR â¤</button>
</div>

<div id="level3-screen" class="screen">
    <p class="level-badge">â­ NIVEL 3 DE 3 â­</p>
    <p class="level-title">NUESTRA HISTORIA</p>
    <p class="level-desc">JUNTOS DESDE EL<br>10 DE MAYO DE 2023</p>
    <div class="countdown-box">
        <p class="countdown-title">ğŸ’• TIEMPO JUNTOS ğŸ’•</p>
        <div class="countdown-numbers">
            <div class="countdown-unit">
                <span class="countdown-val" id="cd-years">0</span>
                <span class="countdown-label">AÃ‘OS</span>
            </div>
            <span class="countdown-sep">:</span>
            <div class="countdown-unit">
                <span class="countdown-val" id="cd-months">0</span>
                <span class="countdown-label">MESES</span>
            </div>
            <span class="countdown-sep">:</span>
            <div class="countdown-unit">
                <span class="countdown-val" id="cd-days">0</span>
                <span class="countdown-label">DÃAS</span>
            </div>
        </div>
    </div>
    <button class="btn yes" onclick="goToQuestion()">SEGUIR â¤</button>
</div>

<div id="question-screen" class="screen">
    <div class="heart-icon" style="font-size:40px;">â¤</div>
    <p class="question-text">Â¿QUERÃ‰S SER MI<br>SAN VALENTINE,<br>GORDA MALA?</p>
    <button class="btn yes" onclick="sayYes(event)">SÃ, OBVIO ğŸ’–</button>
    <button class="btn" id="btn-no">NO</button>
    <p style="font-size:0.38rem; color:#555; margin-top:15px;">INTENTOS DE "NO": <span id="no-counter">0</span></p>
</div>

<div id="final-screen" class="screen">
    <div class="heart-icon" style="font-size:70px; margin-bottom:10px;">â¤</div>
    <h2 id="typewriter"></h2>
</div>

<div class="stats">P1: DYLAN â¤ P2: AGUSTINA | JUNTOS DESDE 10/05/2023</div>

<script>
// â”€â”€â”€ CONFIGURACIÃ“N GLOBAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Cambia esto si quieres corregir la fecha (Mes: 0=Enero, 4=Mayo)
const START_DATE = new Date(2023, 4, 10); 

// â”€â”€â”€ AUDIO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let audioCtx;
function initAudio() {
    if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }
    // Fix para Chrome/Safari Mobile que bloquea el audio al inicio
    if (audioCtx.state === 'suspended') {
        audioCtx.resume();
    }
}
function playNote(freq, start, dur, type='square', vol=0.04) {
    if (!audioCtx) return;
    const osc = audioCtx.createOscillator(), gain = audioCtx.createGain();
    osc.type = type;
    osc.frequency.setValueAtTime(freq, audioCtx.currentTime + start);
    gain.gain.setValueAtTime(vol, audioCtx.currentTime + start);
    gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + start + dur);
    osc.connect(gain); gain.connect(audioCtx.destination);
    osc.start(audioCtx.currentTime + start);
    osc.stop(audioCtx.currentTime + start + dur + 0.01);
}
function playBlip()    { playNote(440,0,0.08); playNote(880,0.05,0.08); }
function playError()   { playNote(220,0,0.15); playNote(180,0.1,0.2); }
function playCorrect() { playNote(523,0,0.1); playNote(659,0.1,0.1); playNote(783,0.2,0.15); }
function playCatch()   { playNote(660,0,0.06); playNote(880,0.05,0.08); }
function playCombo()   { playNote(880,0,0.06); playNote(1100,0.05,0.08); playNote(1320,0.1,0.1); }
function playBomb()    { playNote(150,0,0.08); playNote(100,0.05,0.15,'sawtooth'); }
function playMiss()    { playNote(200,0,0.1); }
function playGameOver(){ playNote(392,0,0.2); playNote(349,0.2,0.2); playNote(330,0.4,0.2); playNote(294,0.6,0.4); }

// BGM
let bgmInterval;
function startBGM() {
    if (!audioCtx) return;
    const p = [[392,0,0.18],[440,0.2,0.18],[494,0.4,0.18],[523,0.6,0.25],[494,0.9,0.18],[440,1.1,0.18],[392,1.3,0.35],[349,1.7,0.18],[392,1.9,0.18],[440,2.1,0.18],[494,2.3,0.25],[440,2.6,0.18],[392,2.8,0.18],[349,3.0,0.35]];
    function loop() { p.forEach(([f,t,d]) => playNote(f,t,d,'triangle',0.03)); }
    loop(); bgmInterval = setInterval(loop, 3600);
}
function stopBGM() { clearInterval(bgmInterval); }

function playFinalMusic() {
    if (!audioCtx) return;
    const m = [523,659,783,1046,783,659,523,523,659,783,880,783,659,523,659,783,1046,1046,880,783,659,523,659,0,784,880,1046,1174,1046,880,784,784,880,1046,1174,1174,1046,880,784,659,784,0,1046,1046,880,784,659,523];
    let t=0;
    m.forEach(f => { if(f>0) playNote(f,t,0.10,'square',0.05); t+=0.12; });
}

// â”€â”€â”€ LOGROS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showAchievement(icon, title) {
    const el = document.createElement('div');
    el.className = 'achievement';
    el.innerHTML = `<div class="ach-label">ğŸ† LOGRO DESBLOQUEADO</div><div class="ach-title">${icon} ${title}</div>`;
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 3000);
}

// â”€â”€â”€ CORAZONES BG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function createHeart(isExplosion=false, x, y) {
    const h = document.createElement('div');
    h.className = 'heart-bg';
    h.innerHTML = Math.random()>0.5 ? 'â¤' : 'ğŸ’•';
    if (isExplosion && x!==undefined) {
        h.style.left=x+'px'; h.style.top=y+'px';
        const angle=Math.random()*Math.PI*2, v=Math.random()*200+80;
        h.animate([{transform:'translate(0,0) scale(1)',opacity:1},{transform:`translate(${Math.cos(angle)*v}px,${Math.sin(angle)*v}px) scale(0)`,opacity:0}],{duration:1200,easing:'ease-out'});
        document.getElementById('hearts-container').appendChild(h);
        setTimeout(()=>h.remove(),1300);
    } else {
        h.style.left=Math.random()*95+'vw';
        h.style.animationDuration=(Math.random()*3+3)+'s';
        h.style.animationDelay=(Math.random()*2)+'s';
        h.style.fontSize=(Math.random()*16+10)+'px';
        document.getElementById('hearts-container').appendChild(h);
        setTimeout(()=>h.remove(),6000);
    }
}
setInterval(()=>createHeart(false),600);

// â”€â”€â”€ CONFETTI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function launchConfetti() {
    const colors=['#ff4d6d','#ffb3c1','#ffd700','#ff85a1','#fff'];
    for(let i=0;i<120;i++) setTimeout(()=>{
        const c=document.createElement('div');
        c.className='confetti-piece';
        c.style.left=Math.random()*100+'vw'; c.style.top='-10px';
        c.style.background=colors[Math.floor(Math.random()*colors.length)];
        c.style.animationDuration=(Math.random()*3+2)+'s';
        c.style.animationDelay=(Math.random()*2)+'s';
        c.style.borderRadius=Math.random()>0.5?'50%':'0';
        document.getElementById('fireworks').appendChild(c);
        setTimeout(()=>c.remove(),5000);
    },i*30);
}

// â”€â”€â”€ PANTALLAS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}

// â”€â”€â”€ INICIO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.addEventListener('load',()=>{
    const now=new Date();
    if(now.getMonth()===1 && now.getDate()===14) {
        showScreen('valentines-special');
        for(let i=0;i<30;i++) setTimeout(()=>createHeart(false),i*100);
    }
});

function goToLoading() {
    initAudio(); startBGM(); playBlip();
    showScreen('loading-screen');
    let w=0;
    const bar=document.getElementById('bar'), txt=document.getElementById('loading-text');
    const iv=setInterval(()=>{
        w++; bar.style.width=w+'%';
        if(w===25)  { txt.innerHTML='CARGANDO RECUERDOS<br>DE LA GORDA MALA...'; playBlip(); }
        if(w===50)  { txt.innerHTML='INSTALANDO<br>CORAZONES PIXELADOS...'; playBlip(); }
        if(w===75)  { txt.innerHTML='CASI LISTO...<br>AGUANTÃ GORDITA â¤'; playBlip(); }
        if(w>=100)  { clearInterval(iv); txt.innerHTML='Â¡LISTO! â¤'; playBlip(); setTimeout(()=>{ showScreen('level1-screen'); buildTrivia(); },600); }
    },80);
}

// â”€â”€â”€ NIVEL 1: TRIVIA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const triviaQ=[
    {q:"Â¿CÃ“MO LE DICE DYLAN\nA AGUSTINA?",opts:["FLACA","PRECIOSA","GORDA","AMORCITO"],ans:2},
    {q:"Â¿DESDE QUÃ‰ MES\nESTÃN JUNTOS?",opts:["MARZO","MAYO","JULIO","ENERO"],ans:1},
    {q:"Â¿EN QUÃ‰ AÃ‘O\nSE JUNTARON?",opts:["2020","2021","2022","2023"],ans:3}
];
let triviaIdx=0;
function buildTrivia(){ triviaIdx=0; renderTrivia(); }
function renderTrivia(){
    const q=triviaQ[triviaIdx];
    document.getElementById('trivia-container').innerHTML=`
        <p style="font-size:0.45rem;color:#ffd700;margin-bottom:8px;">PREGUNTA ${triviaIdx+1} DE ${triviaQ.length}</p>
        <p style="font-size:0.55rem;color:#ffb3c1;line-height:2;margin-bottom:20px;white-space:pre-line;">${q.q}</p>
        <div style="display:flex;flex-wrap:wrap;justify-content:center;gap:10px;">
            ${q.opts.map((o,i)=>`<button class="btn" style="min-width:130px;padding:12px;" onclick="answerTrivia(${i})">${o}</button>`).join('')}
        </div>
        <div id="trivia-feedback" style="height:30px;margin-top:10px;font-size:0.45rem;"></div>`;
}
function answerTrivia(idx){
    const q=triviaQ[triviaIdx];
    const fb=document.getElementById('trivia-feedback');
    document.querySelectorAll('#trivia-container .btn').forEach(b=>b.disabled=true);
    if(idx===q.ans){
        playCorrect(); fb.style.color='#4dff91'; fb.textContent='âœ” Â¡CORRECTO! â¤';
        setTimeout(()=>{
            triviaIdx++;
            if(triviaIdx<triviaQ.length){ renderTrivia(); }
            else { showAchievement('ğŸ§ ','Â¡SABELOTODO!'); setTimeout(()=>{ showScreen('level2-screen'); startGame(); },1200); }
        },900);
    } else {
        playError();
        document.body.classList.add('shake'); setTimeout(()=>document.body.classList.remove('shake'),300);
        fb.style.color='#ff4d6d'; fb.textContent='âœ˜ Â¡GORDA MALA! INTENTÃ DE NUEVO';
        setTimeout(()=>renderTrivia(),900);
    }
}

// â”€â”€â”€ NIVEL 2: MINI JUEGO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const canvas=document.getElementById('game-canvas'), ctx=canvas.getContext('2d');
let score=0, lives=3, gameRunning=false, fallingObjects=[], gameLoopId, spawnTimer=0, combo=0, speedMultiplier=1.0;

function startGame(){
    score=0; lives=3; fallingObjects=[]; gameRunning=true; combo=0; speedMultiplier=1.0; spawnTimer=0;
    document.getElementById('score').textContent='0';
    document.getElementById('combo-display').textContent='x1';
    updateLives(); clearInterval(gameLoopId);
    gameLoopId=setInterval(updateGame,1000/30);
    // Listener de click y touch para el canvas
    canvas.onclick=handleClick; 
    canvas.ontouchstart=handleTouch;
}
function restartGame(){ showScreen('level2-screen'); startGame(); }

function FallingObj(isBomb){
    this.x=Math.random()*260+20; this.y=-25;
    this.speed=(Math.random()*3.5+4)*speedMultiplier;
    this.size=Math.random()*14+18; this.isBomb=isBomb;
    this.wobble=Math.random()*Math.PI*2;
    this.color=isBomb?'#555':['#ff4d6d','#ff85a1','#ffd700','#ff1744'][Math.floor(Math.random()*4)];
}

function spawnObj(){
    const bombChance=Math.min(0.35,0.15+score*0.02);
    fallingObjects.push(new FallingObj(Math.random()<bombChance));
}

function drawHeart(x,y,size,color){
    ctx.save(); ctx.fillStyle=color; ctx.shadowColor=color; ctx.shadowBlur=8;
    ctx.beginPath(); ctx.moveTo(x,y+size*0.3);
    ctx.bezierCurveTo(x,y,x-size*0.5,y,x-size*0.5,y+size*0.3);
    ctx.bezierCurveTo(x-size*0.5,y+size*0.6,x,y+size*0.9,x,y+size);
    ctx.bezierCurveTo(x,y+size*0.9,x+size*0.5,y+size*0.6,x+size*0.5,y+size*0.3);
    ctx.bezierCurveTo(x+size*0.5,y,x,y,x,y+size*0.3); ctx.fill(); ctx.restore();
}

function drawBomb(x,y,size){
    ctx.save(); ctx.font=`${size*1.1}px serif`; ctx.textAlign='center';
    ctx.fillText('ğŸ’£',x,y+size); ctx.restore();
}

function updateGame(){
    if(!gameRunning) return;
    ctx.clearRect(0,0,300,300);
    ctx.strokeStyle='rgba(255,77,109,0.07)'; ctx.lineWidth=1;
    for(let i=0;i<300;i+=30){
        ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,300); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(300,i); ctx.stroke();
    }
    speedMultiplier=1.0+score*0.07;
    spawnTimer++;
    if(spawnTimer>Math.max(20,40-score*2)){ spawnObj(); spawnTimer=0; }
    for(let i=fallingObjects.length-1;i>=0;i--){
        const o=fallingObjects[i];
        o.y+=o.speed; o.wobble+=0.05;
        const wx=o.x+Math.sin(o.wobble)*3;
        if(o.isBomb) drawBomb(wx,o.y,o.size);
        else         drawHeart(wx,o.y,o.size,o.color);
        if(o.y>315){
            fallingObjects.splice(i,1);
            if(!o.isBomb){
                lives--; combo=0;
                document.getElementById('combo-display').textContent='x1';
                playMiss(); updateLives();
                document.body.classList.add('flash-red');
                setTimeout(()=>document.body.classList.remove('flash-red'),400);
                if(lives<=0){ endGame(false); return; }
            }
        }
    }
}

function updateLives(){
    document.getElementById('lives').textContent=['','â¤','â¤â¤','â¤â¤â¤'][Math.max(0,lives)]||'ğŸ’€';
}

function handleClick(e){
    const r=canvas.getBoundingClientRect();
    checkHit((e.clientX-r.left)*(300/r.width),(e.clientY-r.top)*(300/r.height));
}
function handleTouch(e){
    e.preventDefault(); const r=canvas.getBoundingClientRect(), t=e.touches[0];
    checkHit((t.clientX-r.left)*(300/r.width),(t.clientY-r.top)*(300/r.height));
}

function checkHit(cx,cy){
    for(let i=fallingObjects.length-1;i>=0;i--){
        const o=fallingObjects[i], wx=o.x+Math.sin(o.wobble)*3;
        if(Math.hypot(cx-wx,cy-(o.y+o.size*0.5))<o.size*0.9){
            fallingObjects.splice(i,1);
            if(o.isBomb){
                lives--; combo=0;
                document.getElementById('combo-display').textContent='x1';
                playBomb(); updateLives();
                document.body.classList.add('shake','flash-red');
                setTimeout(()=>document.body.classList.remove('shake','flash-red'),400);
                if(lives<=0){ endGame(false); return; }
            } else {
                combo++; score++;
                document.getElementById('score').textContent=score;
                if(combo>=3){ playCombo(); showComboPopup(combo); }
                else          playCatch();
                document.getElementById('combo-display').textContent='x'+combo;
                const r=canvas.getBoundingClientRect();
                createHeart(true,r.left+wx/(300/r.width),r.top+(o.y+o.size*0.5)/(300/r.height));
                if(score>=10){ endGame(true); return; }
            }
            break;
        }
    }
}

function showComboPopup(n){
    const el=document.createElement('div'); el.className='combo-popup';
    el.textContent='COMBO x'+n+'!';
    el.style.left=(Math.random()*40+30)+'vw'; el.style.top=(Math.random()*30+20)+'vh';
    document.body.appendChild(el); setTimeout(()=>el.remove(),900);
}

function endGame(win){
    gameRunning=false; clearInterval(gameLoopId);
    canvas.onclick=null; canvas.ontouchstart=null;
    if(win){ playCorrect(); showAchievement('â¤','Â¡ATRAPADORA DE CORAZONES!'); setTimeout(()=>{ showScreen('level3-screen'); buildCountdown(); },1200); }
    else   { playGameOver(); setTimeout(()=>showScreen('gameover-screen'),800); }
}

// â”€â”€â”€ NIVEL 3: CONTADOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildCountdown(){
    const now=new Date();
    // Usamos la fecha global START_DATE
    let years=now.getFullYear()-START_DATE.getFullYear();
    let months=now.getMonth()-START_DATE.getMonth();
    let days=now.getDate()-START_DATE.getDate();
    
    if(days<0){ 
        months--; 
        // Obtener dÃ­as del mes anterior
        days+=new Date(now.getFullYear(),now.getMonth(),0).getDate(); 
    }
    if(months<0){ years--; months+=12; }
    
    document.getElementById('cd-years').textContent=years;
    document.getElementById('cd-months').textContent=months;
    document.getElementById('cd-days').textContent=days;
    showAchievement('ğŸ“…','Â¡HISTORIADORES DEL AMOR!');
}
function goToQuestion(){
    playBlip();
    noEnabled = false;
    noCount = 0;
    document.getElementById('no-counter').textContent = '0';
    const btnNo = document.getElementById('btn-no');
    
    // Resetear posiciÃ³n
    btnNo.style.position = 'relative';
    btnNo.style.left = '';
    btnNo.style.top = '';
    btnNo.textContent = 'NO';
    
    setTimeout(() => {
        showScreen('question-screen');
        setTimeout(() => { noEnabled = true; }, 800);
    }, 50);
}

// â”€â”€â”€ PREGUNTA Y LÃ“GICA DEL BOTÃ“N NO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let noCount=0;
let noEnabled=false;
const noPhases=["GORDA MALA","GORDA MALVADA","PONÃ‰ QUE SÃ","TE KGO A PALO","DALE :(","GORDA MALA!!","EN SERIO PONÃ‰ SÃ","TE KGO A PALO >:(","DALE GORDIIII :(",  "ÃšLTIMA VEZ... PONÃ‰ SÃ","GORDAAAAA :(","YA SÃ‰ QUE SÃ ğŸ˜"];

// MANEJO MEJORADO DE LOS EVENTOS TOUCH Y MOUSE
const btnNo = document.getElementById('btn-no');

function handleNoInteraction(e) {
    if(!noEnabled) return;
    // Prevenir el click default si es un toque
    if (e.type === 'touchstart') e.preventDefault();
    
    playBlip();
    document.body.classList.add('shake'); setTimeout(()=>document.body.classList.remove('shake'),300);
    noCount++; 
    document.getElementById('no-counter').textContent=noCount;
    
    btnNo.style.position='fixed';
    btnNo.style.left=Math.max(10,Math.floor(Math.random()*(window.innerWidth-btnNo.offsetWidth-10)))+'px';
    btnNo.style.top=Math.max(10,Math.floor(Math.random()*(window.innerHeight-btnNo.offsetHeight-10)))+'px';
    btnNo.textContent=noPhases[noCount%noPhases.length];
}

// Agregar listeners seguros
btnNo.addEventListener('mouseover', handleNoInteraction);
// Passive false es CLAVE para que preventDefault funcione
btnNo.addEventListener('touchstart', handleNoInteraction, {passive: false});
btnNo.addEventListener('click', (e) => e.preventDefault()); // Por seguridad

function getFinalLines(){
    const t=getYearsMonths();
    if(noCount===0) return ["SABÃA QUE IBAS","A DECIR QUE SÃ","SIN DUDAR â¤","","ğŸ’– TE AMO UN","MONTÃ“N, GORDA ğŸ’–","","GRACIAS POR","ESTOS "+t,"JUNTOS â¤"];
    if(noCount<=3)  return ["DUDASTE UN POCO...","PERO AL FINAL","DIJISTE QUE SÃ â¤","","ğŸ’– TE AMO IGUAL,","GORDA MALA ğŸ’–","","JUNTOS "+t,"Y LO QUE FALTA â¤"];
    if(noCount<=7)  return ["INTENTASTE "+noCount+" VECES","DECIR QUE NO...","Â¡GORDA MALVADA! ğŸ˜‚","","IGUAL TE AMO ğŸ’–","PORQUE SOS MÃA","Y YO SOY TUYO â¤","","JUNTOS "+t,"JUNTOS â¤"];
    return ["Â¡"+noCount+" VECES!!!","GORDA MALA DE VERDAD","JAJAJAJAJA ğŸ’€","","PERO IGUAL DIJISTE","QUE SÃ AL FINAL","Â¡SABÃA QUE SÃ! ğŸ’–","","TE AMO GORDA â¤"];
}

function sayYes(e){
    if(e) { e.stopPropagation(); }
    stopBGM(); playFinalMusic(); launchConfetti();
    for(let i=0;i<200;i++) setTimeout(()=>createHeart(false),i*20);
    showScreen('final-screen'); showAchievement('ğŸ’','Â¡MI SAN VALENTINE!');
    const lines=getFinalLines(), el=document.getElementById('typewriter');
    let li=0, ci=0;
    function type(){
        if(li>=lines.length) return;
        const line=lines[li];
        if(ci<line.length){ el.innerHTML+=line[ci]===' '?'&nbsp;':line[ci]; ci++; setTimeout(type,55); }
        else { el.innerHTML+='<br>'; li++; ci=0; setTimeout(type,lines[li]===''?200:80); }
    }
    type();
}

function getYearsMonths(){
    const now=new Date();
    // Uso de START_DATE
    let years=now.getFullYear()-START_DATE.getFullYear();
    let months=now.getMonth()-START_DATE.getMonth();
    
    if(now.getDate() < START_DATE.getDate()) months--;
    if(months<0){ years--; months+=12; }
    
    if(years===0) return months+' MESES';
    return years+' AÃ‘O'+(years>1?'S':'')+(months>0?' Y '+months+' MES'+(months>1?'ES':''):'');
}

// â”€â”€â”€ ESTRELLAS DE FONDO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function(){
    const sc = document.getElementById('stars-canvas');
    const sctx = sc.getContext('2d');

    function resize(){
        sc.width  = window.innerWidth;
        sc.height = window.innerHeight;
    }
    resize();
    window.addEventListener('resize', resize);

    const NUM_STARS   = 120;
    const NUM_SPARKLE = 18;

    function makeStar(){
        return {
            x: Math.random() * window.innerWidth,
            y: Math.random() * window.innerHeight,
            size: Math.random() * 1.8 + 0.4,
            alpha: Math.random(),
            speed: Math.random() * 0.008 + 0.003,
            dir: Math.random() > 0.5 ? 1 : -1,
            color: ['rgba(255,255,255,', 'rgba(255,180,200,', 'rgba(255,220,100,'][Math.floor(Math.random()*3)]
        };
    }

    function makeSparkle(){
        return {
            x: Math.random() * window.innerWidth,
            y: Math.random() * window.innerHeight,
            size: Math.random() * 4 + 3,
            alpha: Math.random(),
            speed: Math.random() * 0.012 + 0.005,
            dir: Math.random() > 0.5 ? 1 : -1,
            color: Math.random() > 0.5 ? 'rgba(255,180,200,' : 'rgba(255,220,100,'
        };
    }

    const stars    = Array.from({length: NUM_STARS},   makeStar);
    const sparkles = Array.from({length: NUM_SPARKLE}, makeSparkle);

    function drawPixelStar(x, y, size, alpha, color){
        sctx.fillStyle = color + alpha + ')';
        const s = Math.ceil(size);
        sctx.fillRect(Math.round(x)-s, Math.round(y)-s, s*2, s*2);
        sctx.fillStyle = color + (alpha*0.6) + ')';
        sctx.fillRect(Math.round(x)-Math.ceil(s/2), Math.round(y)-s*3, Math.ceil(s), s*2);
        sctx.fillRect(Math.round(x)-Math.ceil(s/2), Math.round(y)+s,   Math.ceil(s), s*2);
        sctx.fillRect(Math.round(x)-s*3, Math.round(y)-Math.ceil(s/2), s*2, Math.ceil(s));
        sctx.fillRect(Math.round(x)+s,   Math.round(y)-Math.ceil(s/2), s*2, Math.ceil(s));
    }

    function animateStars(){
        sctx.clearRect(0, 0, sc.width, sc.height);
        for(const s of stars){
            s.alpha += s.speed * s.dir;
            if(s.alpha >= 1){ s.alpha = 1; s.dir = -1; }
            if(s.alpha <= 0){ s.alpha = 0; s.dir =  1; s.x = Math.random() * sc.width; s.y = Math.random() * sc.height; }
            const px = Math.ceil(s.size);
            sctx.fillStyle = s.color + s.alpha + ')';
            sctx.fillRect(Math.round(s.x), Math.round(s.y), px, px);
        }
        for(const sp of sparkles){
            sp.alpha += sp.speed * sp.dir;
            if(sp.alpha >= 1){ sp.alpha = 1; sp.dir = -1; }
            if(sp.alpha <= 0){ sp.alpha = 0; sp.dir =  1; sp.x = Math.random() * sc.width; sp.y = Math.random() * sc.height; }
            drawPixelStar(sp.x, sp.y, sp.size, sp.alpha, sp.color);
        }
        requestAnimationFrame(animateStars);
    }
    animateStars();
})();

// â”€â”€â”€ GATITOS TUXEDO ESTILO MINECRAFT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function(){
    const cc   = document.getElementById('cats-canvas');
    const cctx = cc.getContext('2d');
    const S = 4; // Escala
    const C = { 1:'#111111', 2:'#eeeeee', 3:'#ff99bb', 4:'#44cc66', 5:'#555555', 6:'#222222' };

    const HEAD = [[1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1],[1,1,4,1,1,4,1,1],[1,1,4,1,1,4,1,1],[1,1,1,1,1,1,1,1],[1,1,1,3,3,1,1,1],[1,2,2,2,2,2,2,1],[1,1,1,1,1,1,1,1]];
    const HEAD_BLINK = HEAD.map((row,ri)=>row.map(v=>(ri===2||ri===3)&&v===4?1:v));
    const EAR = [[1,3],[1,1],[1,1]];
    const BODY = [[1,1,2,2,2,2,1,1],[1,2,2,2,2,2,2,1],[1,2,2,1,1,2,2,1],[1,2,2,1,1,2,2,1],[1,1,1,1,1,1,1,1]];
    const LEGS = [[1,2,2,1,1,2,2,1],[1,2,2,1,1,2,2,1],[1,1,1,1,1,1,1,1]];

    function drawPixels(grid, ox, oy, flipX){
        const cols = grid[0].length;
        for(let r=0;r<grid.length;r++){
            for(let c=0;c<cols;c++){
                const v=grid[r][c];
                if(!v||!C[v]) continue;
                cctx.fillStyle=C[v];
                const px=flipX?ox+(cols-1-c)*S:ox+c*S;
                cctx.fillRect(px,oy+r*S,S,S);
            }
        }
    }

    function drawTail(ox, oy, wagAngle, flipX){
        const wag = Math.round(Math.sin(wagAngle)*2);
        const segs=[{dx:1,dy:0},{dx:2,dy:-1},{dx:3,dy:-2},{dx:4,dy:-2},{dx:4,dy:-1},{dx:3,dy:0},{dx:2,dy:1}];
        segs.forEach(({dx,dy},i)=>{
            cctx.fillStyle = i>=segs.length-2 ? C[2] : C[1];
            const px=flipX?ox-dx*S:ox+dx*S;
            cctx.fillRect(px,(oy+(dy+wag)*S),S*2,S*2);
        });
    }

    function drawName(name, cx, y){
        cctx.save();
        cctx.font='7px "Press Start 2P",monospace';
        cctx.textAlign='center';
        cctx.textBaseline='alphabetic';
        const tw=cctx.measureText(name).width;
        const pad=4;
        cctx.fillStyle='rgba(0,0,0,0.65)';
        cctx.fillRect(Math.round(cx-tw/2-pad),Math.round(y-9-pad),Math.round(tw+pad*2),Math.round(9+pad*2));
        cctx.fillStyle='#3a1020';
        cctx.fillText(name,cx+1,y+1);
        cctx.fillStyle='#ffffff';
        cctx.fillText(name,cx,y);
        cctx.restore();
    }

    const CAT_W=8*S, EAR_H=3*S, HEAD_H=8*S, BODY_H=5*S, LEGS_H=3*S, TOTAL_H=EAR_H+HEAD_H+BODY_H+LEGS_H;
    const cats = [
        {name:'Pochocleis', x:0, y:0, wagT:0,   blinkT:0,  blink:false, side:'left' },
        {name:'Milaneis',   x:0, y:0, wagT:1.6, blinkT:55, blink:false, side:'right'},
    ];

    function placeCats(){
        cc.width = window.innerWidth; cc.height = window.innerHeight;
        const W=cc.width, H=cc.height;
        const baseY = H - TOTAL_H - 32 - 20;
        cats[0].x = Math.round(W*0.12);
        cats[0].y = baseY;
        cats[1].x = Math.round(W*0.88) - CAT_W;
        cats[1].y = baseY;
    }
    placeCats();
    window.addEventListener('resize', placeCats);

    function animateCats(){
        cctx.clearRect(0,0,cc.width,cc.height);
        for(const cat of cats){
            cat.wagT+=0.06;
            cat.blinkT++;
            if(!cat.blink && cat.blinkT>120){ cat.blink=true;  cat.blinkT=0; }
            else if(cat.blink && cat.blinkT>6){ cat.blink=false; cat.blinkT=0; }
            
            const {x,y,wagT,blink,side}=cat;
            const flipX=side==='right';
            drawPixels(EAR, flipX?x+CAT_W-2*S:x, y, false);
            drawPixels(EAR, flipX?x:x+CAT_W-2*S, y, true);
            drawPixels(blink?HEAD_BLINK:HEAD, x, y+EAR_H, flipX);
            drawPixels(BODY, x, y+EAR_H+HEAD_H, flipX);
            drawPixels(LEGS, x, y+EAR_H+HEAD_H+BODY_H, flipX);
            const tailX=flipX?x-S:x+CAT_W;
            drawTail(tailX, y+EAR_H+HEAD_H+S, wagT, flipX);
            drawName(cat.name, x+CAT_W/2, y-6);
        }
        requestAnimationFrame(animateCats);
    }
    animateCats();
})();
</script>

</body>
</html>
